#!/bin/bash

CUR_DIR=`dirname $(realpath "$0")`;
LIB_ROOT=`realpath "$CUR_DIR/../"`;
export NODE_PATH="$LIB_ROOT/..:$LIB_ROOT/node_modules/:$NODE_PATH";


cd $LIB_ROOT;
export PATH="$(npm bin):$PATH";
cd -;
nodejs='nodejs'
if ! which nodejs >/dev/null 2>&1; then
  nodejs='node'
fi;

if echo "$@"|grep -e '--debug';then
  if which nodemon>/dev/null 2>&1; then

    # Use nodemon for `run --debug`
    nodemon --watch "$LIB_ROOT" -e js "$LIB_ROOT/bin/cmd.js" "$@"
  else
    echo 'You need to run "npm install nodemon -g" by yourself first.';
    exit 1;
  fi;
else
  $nodejs "$LIB_ROOT/bin/cmd.js" "$@"
fi;


